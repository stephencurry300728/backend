(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-231243c9"],{"45f0":function(e,t,a){"use strict";a("a0fe")},"90fe":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-dialog",{staticClass:"custom-dialog",attrs:{title:"编辑数据",visible:e.editDialogVisible,align:"center"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[a("el-form",{staticClass:"compact-form",attrs:{model:e.editForm}},[a("el-form-item",{attrs:{label:"记录日期"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editForm.record_date,callback:function(t){e.$set(e.editForm,"record_date",t)},expression:"editForm.record_date"}})],1),a("el-form-item",{attrs:{label:"乘务班组"}},[a("el-input",{model:{value:e.editForm.crew_group,callback:function(t){e.$set(e.editForm,"crew_group",t)},expression:"editForm.crew_group"}})],1),a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),a("el-form-item",{attrs:{label:"工作证号"}},[a("el-input",{model:{value:e.editForm.work_certificate_number,callback:function(t){e.$set(e.editForm,"work_certificate_number",t)},expression:"editForm.work_certificate_number"}})],1),a("el-form-item",{attrs:{label:"车型"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editForm.train_model,callback:function(t){e.$set(e.editForm,"train_model",t)},expression:"editForm.train_model"}})],1),a("el-form-item",{attrs:{label:"考核项目"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editForm.assessment_item,callback:function(t){e.$set(e.editForm,"assessment_item",t)},expression:"editForm.assessment_item"}})],1),a("el-form-item",{attrs:{label:"考核结果"}},[a("el-input",{attrs:{value:e.formatAssessmentResult(e.editForm.assessment_result),readonly:""}})],1),a("el-form-item",{attrs:{label:"文件来源"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editForm.file_name,callback:function(t){e.$set(e.editForm,"file_name",t)},expression:"editForm.file_name"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("保存")])],1)],1),a("div",{staticClass:"filters-container"},[a("div",{staticClass:"reset-button-container"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.resetFilters}},[e._v("重置")])],1),a("div",{staticClass:"date-picker-offset"},[a("el-date-picker",{staticStyle:{width:"250px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{input:e.onDateRangeChange,change:e.onDateRangeChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),a("div",{staticClass:"select-container"},[a("el-select",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择线路"},on:{change:e.fetchData},model:{value:e.selectedLine,callback:function(t){e.selectedLine=t},expression:"selectedLine"}},[a("el-option",{attrs:{label:"1号线",value:"01"}}),a("el-option",{attrs:{label:"5号线",value:"05"}}),a("el-option",{attrs:{label:"9号线",value:"09"}}),a("el-option",{attrs:{label:"10号线",value:"10"}}),a("el-option",{attrs:{label:"所有线路",value:""}})],1)],1),a("div",{staticClass:"select-container select-offset"},[a("el-select",{staticStyle:{width:"222px",height:"40px","font-size":"16px"},attrs:{disabled:e.isSubjectDisabled,clearable:"",placeholder:"请选择科目"},model:{value:e.selectedOption,callback:function(t){e.selectedOption=t},expression:"selectedOption"}},e._l(e.filteredOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("div",{staticClass:"analysis-button-container"},[a("el-button",{staticStyle:{width:"150px"},attrs:{type:"danger",size:"big"},on:{click:e.analyzeTrainingOverview}},[e._v("培训概况分析")])],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticClass:"custom-table",attrs:{data:e.list,"element-loading-text":"拼命加载中",border:"",fit:"","highlight-current-row":"",stripe:"",height:"758","default-sort":{prop:e.sort.prop,order:e.sort.order}},on:{"sort-change":e.handleSortChange}},[a("el-table-column",{attrs:{align:"center",label:"ID",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}])}),a("el-table-column",{attrs:{label:"记录日期",prop:"record_date",sortable:"custom",align:"center"}}),a("el-table-column",{attrs:{label:"乘务班组",prop:"crew_group",sortable:"custom",align:"center"}}),a("el-table-column",{attrs:{label:"姓名",prop:"name",sortable:"custom",align:"center"}}),a("el-table-column",{attrs:{label:"工作证号",prop:"work_certificate_number",sortable:"custom",align:"center"}}),a("el-table-column",{attrs:{label:"车型",prop:"train_model",sortable:"custom",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"link-like",on:{click:function(a){return a.stopPropagation(),e.goToDetail(t.row)}}},[e._v(" "+e._s(t.row.train_model))])]}}])}),a("el-table-column",{attrs:{label:"考核项目",prop:"assessment_item",sortable:"custom",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"link-like",on:{click:function(a){return a.stopPropagation(),e.goToDetail(t.row)}}},[e._v(" "+e._s(t.row.assessment_item))])]}}])}),a("el-table-column",{attrs:{label:"考核结果",prop:"assessment_result",sortable:"custom",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:e.getAssessmentClass(t.row.assessment_result),staticStyle:{cursor:"pointer"},on:{click:function(a){return a.stopPropagation(),e.goToDetail(t.row)}}},[e._v(" "+e._s(e.formatAssessmentResult(t.row.assessment_result))+" ")])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.editItem(t.row)}}},[a("i",{staticClass:"el-icon-edit"}),e._v(" 编辑 ")]),a("el-button",{staticStyle:{"margin-left":"10px",color:"red"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.deleteItem(t.row)}}},[a("i",{staticClass:"el-icon-delete"}),e._v(" 删除 ")])]}}])})],1),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":e.computedPageSizes,"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},n=[],r=a("c7eb"),i=a("1da1"),o=a("3835"),l=(a("99af"),a("4de4"),a("d81d"),a("4e82"),a("e9c4"),a("b64b"),a("d3b7"),a("2ca0"),a("5a0c")),c=a.n(l),u=a("2ef0"),d=a("ad8f"),p=a("9e07"),m={data:function(){return{list:[],listLoading:!0,total:0,currentPage:1,pageSize:12,tableKey:0,sort:{prop:"",order:""},dateRange:[new Date(2023,9,10),void 0],editDialogVisible:!1,editForm:{},selectedLine:"",selectedOption:null,combinedOptions:[]}},created:function(){this.fetchData=Object(u["debounce"])(this.fetchData,5),this.restoreStateFromLocalStorage(),this.fetchData()},mounted:function(){this.loadAllTrainAndAssessmentItems()},watch:{selectedLine:function(e,t){e!==t&&(this.selectedOption=null,this.fetchData(),this.updateFilters())},selectedOption:function(e,t){e!==t&&(this.fetchData(),this.updateFilters())}},computed:{isSubjectDisabled:function(){return""===this.selectedLine},filteredOptions:function(){var e=this;return""===this.selectedLine?[]:this.combinedOptions.filter((function(t){return t.value.startsWith(e.selectedLine)}))},computedPageSizes:function(){var e=this,t=[12,30,50,100];return t=t.filter((function(t){return t<=e.total})),-1===t.indexOf(this.total)&&t.push(this.total),t.sort((function(e,t){return e-t})),t}},methods:{buildQueryParams:function(){var e="descending"===this.sort.order?"-".concat(this.sort.prop):this.sort.prop,t={page:this.currentPage,page_size:this.pageSize,ordering:e,start_date:this.dateRange[0]?c()(this.dateRange[0]).format("YYYY-MM-DD"):"",end_date:this.dateRange[1]?c()(this.dateRange[1]).format("YYYY-MM-DD"):""};if(this.selectedLine&&(t.train_model_line=this.selectedLine),this.selectedOption){var a=this.selectedOption.split("-"),s=Object(o["a"])(a,2),n=s[0],r=s[1];t.train_model=n,t.assessment_item=r}return t},fetchData:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var a,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,a=e.buildQueryParams(),t.prev=2,t.next=5,Object(d["e"])(a);case 5:if(s=t.sent,s.data.results.length||!(e.currentPage>1)){t.next=12;break}return e.currentPage=1,t.next=10,e.fetchData();case 10:t.next=14;break;case 12:e.list=s.data.results,e.total=s.data.count;case 14:t.next=23;break;case 16:if(t.prev=16,t.t0=t["catch"](2),console.error("Error fetching data:",t.t0),!(e.currentPage>1)){t.next=23;break}return e.currentPage=1,t.next=23,e.fetchData();case 23:return t.prev=23,e.listLoading=!1,t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[2,16,23,26]])})))()},analyzeTrainingOverview:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var a,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.buildQueryParams(),t.next=4,Object(d["a"])(a);case 4:s=t.sent,e.$store.dispatch("table/updateTrainingAnalysisData",s.data),sessionStorage.setItem("fromAnalyze","true"),e.$router.push({name:"TrainingAnalysis"}),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("培训概况分析请求失败:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},updateFilters:function(){var e={page:this.currentPage,pageSize:this.pageSize,sortProp:this.sort.prop,sortOrder:this.sort.order,startDate:this.dateRange[0]?c()(this.dateRange[0]).format("YYYY-MM-DD"):"",endDate:this.dateRange[1]?c()(this.dateRange[1]).format("YYYY-MM-DD"):"",selectedLine:this.selectedLine,trainModel:this.selectedOption?this.selectedOption.split("-")[0]:"",assessmentItem:this.selectedOption?this.selectedOption.split("-")[1]:""};localStorage.setItem("tableFilters",JSON.stringify(e))},restoreStateFromLocalStorage:function(){var e={page:1,pageSize:12,sortProp:"",sortOrder:"",startDate:"",endDate:"",trainModel:"",assessmentItem:"",selectedLine:""},t=JSON.parse(localStorage.getItem("tableFilters"))||e;this.currentPage=t.page,this.pageSize=t.pageSize,this.sort.prop=t.sortProp,this.sort.order=t.sortOrder,this.dateRange=[t.startDate?new Date(t.startDate):void 0,t.endDate?new Date(t.endDate):void 0],this.selectedLine=t.selectedLine,this.selectedOption=t.trainModel&&t.assessmentItem?"".concat(t.trainModel,"-").concat(t.assessmentItem):null},loadAllTrainAndAssessmentItems:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var a,s;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(d["c"])();case 3:a=t.sent,s=a.data.sort((function(e,t){return e.train_model.localeCompare(t.train_model)})),e.combinedOptions=s.map((function(e){return{label:"".concat(e.train_model," - ").concat(e.assessment_item),value:"".concat(e.train_model,"-").concat(e.assessment_item)}})),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("获取数据失败：",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},resetFilters:function(){this.dateRange=[new Date(2023,9,10),void 0],this.currentPage=1,this.pageSize=12,this.tableKey+=1,this.sort={prop:"",order:""},this.selectedLine="",this.selectedOption=null,this.updateFilters(),this.fetchData()},onDateRangeChange:function(e){e&&0!==e.length&&(e[0]||e[1])?this.dateRange=e:this.dateRange=[void 0,void 0],this.currentPage=1,this.updateFilters(),this.fetchData()},handleSortChange:function(e){var t=e.prop,a=e.order;this.sort.prop===t?(this.sort.order="ascending"===this.sort.order?"descending":"descending"===this.sort.order?"":"ascending",""===this.sort.order&&(this.sort.prop="")):(this.sort.prop=t,this.sort.order=a),this.updateFilters(),this.fetchData()},handleCurrentChange:function(e){this.currentPage=e,this.updateFilters(),this.fetchData()},handleSizeChange:function(e){this.pageSize=e,this.updateFilters(),this.fetchData()},formatAssessmentResult:function(e){return Object(p["a"])(e)},getAssessmentClass:function(e){switch(e){case 3:return"highlight-excellent";case 2:return"highlight-qualified";case 1:return"highlight-Unqualified";default:return""}},editItem:function(e){this.editForm=Object.assign({},e),this.editDialogVisible=!0},saveEdit:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.editForm.id,t.next=4,Object(d["f"])(a,e.editForm);case 4:return e.editDialogVisible=!1,t.next=7,e.fetchData();case 7:e.$message.success("更新成功"),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("更新失败:",t.t0),e.$message.error("更新失败");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},deleteItem:function(e){var t=this;return Object(i["a"])(Object(r["a"])().mark((function a(){return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return a.next=5,Object(d["b"])(e.id);case 5:return t.$message({type:"success",message:"删除成功!"}),a.next=8,t.fetchData();case 8:a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),a.t0&&"cancel"!==a.t0?t.$message.error("删除失败"):"cancel"===a.t0&&t.$message({type:"info",message:"已取消删除"});case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},goToDetail:function(e){this.$router.push({name:"AssessmentDetail",params:{id:e.id}})}}},h=m,f=(a("f244"),a("45f0"),a("2877")),g=Object(f["a"])(h,s,n,!1,null,"e2e500f4",null);t["default"]=g.exports},"9e07":function(e,t,a){"use strict";function s(e){switch(e){case 3:return"优秀";case 2:return"合格";case 1:return"不合格";default:return"其他"}}a.d(t,"a",(function(){return s}))},a0fe:function(e,t,a){},ad8f:function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"d",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return c}));var s=a("b775");function n(e){return Object(s["a"])({url:"/assessment-base/",method:"get",params:e})}function r(e){return Object(s["a"])({url:"/assessment-base/".concat(e,"/"),method:"get"})}function i(e,t){return Object(s["a"])({url:"/assessment-base/".concat(e,"/"),method:"patch",data:t})}function o(e){return Object(s["a"])({url:"/assessment-base/".concat(e,"/"),method:"delete"})}function l(){return Object(s["a"])({url:"/assessment-base/all-train-and-assessment/",method:"get"})}function c(e){return Object(s["a"])({url:"/assessment-base/unpaged-data/",method:"get",params:e})}},db39:function(e,t,a){},f244:function(e,t,a){"use strict";a("db39")}}]);