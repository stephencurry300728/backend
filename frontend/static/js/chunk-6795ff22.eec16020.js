(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6795ff22"],{"34b7":function(t,e,a){"use strict";a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));var n=a("b775");function s(t){return Object(n["a"])({url:"/save-classification/",method:"post",data:t})}function i(){return Object(n["a"])({url:"/data-categories/",method:"get"})}},"3ac6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"containerRef",staticClass:"container"},[a("div",{staticClass:"header"},[a("h2",{staticStyle:{"margin-left":"20px"}},[t._v("一、 培训概况")]),a("el-button",{attrs:{loading:t.loading,type:"primary",icon:"el-icon-download"},on:{click:t.exportAsPNG}},[t._v("导出图片")])],1),t.trainingAnalysisData&&t.trainingAnalysisData.length>0?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text-center"},[a("span",{staticClass:"training-line"},[t._v(" "+t._s(t.processedData.lineNames))]),t._v(" 共计参加 "),a("span",{staticClass:"training-items"},[t._v(t._s(t.processedData.trainingItems))]),t._v(" 培训人数为："),a("span",{staticClass:"total-count"},[t._v(t._s(t.processedData.totalCount))]),t._v("人 合格率："),a("span",{staticClass:"pass-rate"},[t._v(t._s(t.processedData.passRate)+"%")])]),a("div",{staticClass:"tableData"},[a("el-table",{attrs:{data:t.tableData,fit:"","element-loading-text":"拼命加载中",border:"",stripe:"","empty-text":"无数据"}},[a("el-table-column",{attrs:{prop:"crew_group",label:"班组",width:"180",align:"center"}}),a("el-table-column",{attrs:{prop:"count",label:"人数",align:"center"}}),a("el-table-column",{attrs:{prop:"excellent",label:"优秀",align:"center"}}),a("el-table-column",{attrs:{prop:"qualified",label:"合格",align:"center"}}),a("el-table-column",{attrs:{prop:"unqualified",label:"不合格",align:"center"}})],1)],1)]):a("div",{staticClass:"no-data"},[t._v(" 无培训数据 ")]),a("h2",{staticStyle:{"margin-left":"20px"}},[t._v("二、 问题分析")]),t.missingFileNames.length>0?a("div",{staticClass:"no-data-info"},[a("p",[t._v(" 文件名： "+t._s(t.missingFileNames.join("，"))+" 缺少步骤归类！ 请"),a("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.goToSettings.apply(null,arguments)}}},[t._v("点击这里")]),t._v("去为其设置步骤归类 ")])]):t._e(),a("div",{staticClass:"tableData"},[a("el-card",{staticClass:"box-card"},[a("el-select",{staticClass:"select-analysis-type",attrs:{clearable:"",placeholder:"请选择班组"},model:{value:t.selectedCrewGroup,callback:function(e){t.selectedCrewGroup=e},expression:"selectedCrewGroup"}},t._l(t.crewGroupOptions,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1),a("el-select",{staticClass:"select-analysis-type",attrs:{clearable:"",placeholder:"请选择分析类型"},model:{value:t.selectedAnalysisType,callback:function(e){t.selectedAnalysisType=e},expression:"selectedAnalysisType"}},[a("el-option",{attrs:{label:"所有人",value:"all"}}),a("el-option",{attrs:{label:"不合格",value:"fail"}})],1),a("el-table",{attrs:{data:t.flattenedIssues,border:"",stripe:"","span-method":t.spanMethod,"empty-text":"无数据"}},[a("el-table-column",{attrs:{prop:"group",label:"步骤归类",align:"center",width:"220"}}),a("el-table-column",{attrs:{prop:"classification",label:"详情操作",align:"center"}}),a("el-table-column",{attrs:{prop:"percentage",label:"错误占比",align:"center"}})],1)],1)],1)],1)},s=[],i=a("c7eb"),r=a("1da1"),c=a("3835"),l=a("2909"),o=a("5530"),u=(a("99af"),a("4de4"),a("7db0"),a("5db7"),a("a15b"),a("d81d"),a("13d5"),a("4e82"),a("73d9"),a("b680"),a("4fad"),a("b64b"),a("d3b7"),a("07ac"),a("ac1f"),a("6062"),a("3ca3"),a("466d"),a("159b"),a("ddb0"),a("2f62")),p=a("34b7"),f=a("c0e9"),d=a.n(f),b={name:"TrainingAnalysis",data:function(){return{categories:[],selectedAnalysisType:"all",selectedCrewGroup:"",crewGroupOptions:[],loading:!1}},created:function(){sessionStorage.getItem("fromAnalyze")?sessionStorage.removeItem("fromAnalyze"):this.$router.push({name:"table"})},mounted:function(){this.fetchDataCategories()},watch:{trainingAnalysisData:{immediate:!0,handler:function(){this.updateCrewGroupOptions()}}},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])("table",["trainingAnalysisData"])),{},{processedData:function(){if(!this.trainingAnalysisData||0===this.trainingAnalysisData.length)return{lineNames:"",totalCount:0,passRate:0,trainingItems:""};var t=this.trainingAnalysisData,e=Object(l["a"])(new Set(t.map((function(t){return t.trainLines})))).sort(),a=t.length,n=t.filter((function(t){return 2===t.assessment_result||3===t.assessment_result})).length,s=(n/a*100).toFixed(2),i=e.map((function(t){switch(t){case"01":return"1号线";case"05":return"5号线";case"09":return"9号线";case"10":return"10号线";default:return"".concat(t,"号线")}})).join(" / "),r=Object(l["a"])(new Set(t.map((function(t){return"".concat(t.train_model,"-").concat(t.assessment_item)})))).join("， ");return{lineNames:i,totalCount:a,passRate:s,trainingItems:r}},tableData:function(){if(!this.trainingAnalysisData||0===this.trainingAnalysisData.length)return[];var t=this.trainingAnalysisData.reduce((function(t,e){return t[e.crew_group]||(t[e.crew_group]={count:0,excellent:0,qualified:0,unqualified:0}),t[e.crew_group].count++,3===e.assessment_result?t[e.crew_group].excellent++:2===e.assessment_result?t[e.crew_group].qualified++:1===e.assessment_result&&t[e.crew_group].unqualified++,t}),{});return Object.keys(t).map((function(e){return{crew_group:e,count:t[e].count,excellent:"".concat(t[e].excellent," (").concat((t[e].excellent/t[e].count*100).toFixed(2),"%)"),qualified:"".concat(t[e].qualified," (").concat((t[e].qualified/t[e].count*100).toFixed(2),"%)"),unqualified:"".concat(t[e].unqualified," (").concat((t[e].unqualified/t[e].count*100).toFixed(2),"%)")}}))},issueAnalysis:function(){var t=this,e=this.trainingAnalysisData;"fail"===this.selectedAnalysisType&&(e=e.filter((function(t){return 1===t.assessment_result}))),this.selectedCrewGroup&&(e=e.filter((function(e){return e.crew_group===t.selectedCrewGroup})));var a=0,n={},s=new Set(this.categories.map((function(t){return t.file_name})));return this.categories.forEach((function(t){Object.values(t.classifications).forEach((function(t){n[t]||(n[t]={nullCount:0,total:0,classifications:{}})}))})),e.forEach((function(e){s.has(e.file_name)&&Object.entries(e.additional_data).forEach((function(e){var s=Object(c["a"])(e,2),i=s[0],r=s[1],l=t.categories.flatMap((function(t){return Object.entries(t.classifications).filter((function(t){var e=Object(c["a"])(t,2),a=e[0];e[1];return a===i})).map((function(t){var e=Object(c["a"])(t,2),a=(e[0],e[1]);return a}))})).find(Boolean);l&&n[l]&&(n[l].total++,n[l].classifications[i]||(n[l].classifications[i]={nullCount:0,total:0}),n[l].classifications[i].total++,null===r&&(a++,n[l].nullCount++,n[l].classifications[i].nullCount++))}))})),Object.values(n).forEach((function(t){t.percentage=a>0?"".concat((t.nullCount/a*100).toFixed(2),"%"):"0.00%",t.classifications=Object.entries(t.classifications).reduce((function(t,e){var n=Object(c["a"])(e,2),s=n[0],i=n[1],r=a>0?"".concat((i.nullCount/a*100).toFixed(2),"%"):"0.00%";return t[s]=Object(o["a"])(Object(o["a"])({classification:s},i),{},{display:"".concat(i.nullCount,"人 (").concat(r,")")}),t}),{})})),n},flattenedIssues:function(){var t=this.issueAnalysis,e=[],a=["识故问题","操作问题","安全问题"],n=Object.keys(t).sort((function(t,e){return a.indexOf(t)-a.indexOf(e)}));return n.forEach((function(a){var n=t[a],s=Object.values(n.classifications).sort((function(t,e){var a=parseInt(t.display.match(/\d+/)[0],10),n=parseInt(e.display.match(/\d+/)[0],10);return n-a}));s.forEach((function(t,i){0===i?e.push({group:"".concat(a," (").concat(n.percentage,")"),classification:t.classification,percentage:t.display,rowspan:s.length}):e.push({group:a,classification:t.classification,percentage:t.display,rowspan:0})}))})),e},missingFileNames:function(){var t=new Set(this.trainingAnalysisData.map((function(t){return t.file_name}))),e=new Set(this.categories.map((function(t){return t.file_name}))),a=Object(l["a"])(t).filter((function(t){return!e.has(t)}));return a=a.sort((function(t,e){var a=t.match(/(\d+)([a-zA-Z]+)(\d*)/),n=e.match(/(\d+)([a-zA-Z]+)(\d*)/),s=parseInt(a[1],10),i=parseInt(n[1],10);if(s!==i)return s-i;if(a[2]!==n[2])return a[2].localeCompare(n[2]);var r=a[3]?parseInt(a[3],10):0,c=n[3]?parseInt(n[3],10):0;return r-c})),a}}),methods:{fetchDataCategories:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(p["b"])();case 3:a=e.sent,t.categories=a.data,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error fetching categories:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},updateCrewGroupOptions:function(){if(this.trainingAnalysisData&&this.trainingAnalysisData.length>0){var t=new Set(this.trainingAnalysisData.map((function(t){return t.crew_group})));this.crewGroupOptions=Object(l["a"])(t)}else this.crewGroupOptions=[]},spanMethod:function(t){var e=t.row,a=(t.column,t.rowIndex,t.columnIndex);return 0===a?[e.rowspan,1]:[1,1]},goToSettings:function(){this.$router.push({path:"/settings"})},exportAsPNG:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a,n,s,r;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.$nextTick();case 4:if(a=t.$refs.containerRef,a){e.next=9;break}return console.error("Cannot find element with ref 'containerRef'"),t.loading=!1,e.abrupt("return");case 9:return e.next=11,d()(a);case 11:n=e.sent,s=n.toDataURL("image/png"),r=document.createElement("a"),r.href=s,r.download="培训概况.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](1),console.error("Error generating PNG: ",e.t0);case 24:return e.prev=24,t.loading=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,21,24,27]])})))()}}},g=b,h=(a("3ebb"),a("2877")),m=Object(h["a"])(g,n,s,!1,null,"cda4ef50",null);e["default"]=m.exports},"3ebb":function(t,e,a){"use strict";a("eb14")},eb14:function(t,e,a){}}]);